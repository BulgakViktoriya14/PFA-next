(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[277],{1887:function(t,e,n){"use strict";function r(t){return{type:"SET_USER_SUM",payload:t}}n.d(e,{A:function(){return r}})},5119:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return I}});var r=n(5893),s=n(6610),a=n(5991),o=n(3349),i=n(5255),u=n(6070),c=n(7608),l=n(6156),f=n(7294),p=n(1871),d=n(8278),h=n(4494),m=n(1163);var g=n(1887);var v=n(887);function y(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var s=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var Z=function(t){(0,i.Z)(n,t);var e=y(n);function n(){return(0,s.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){return(0,r.jsx)("button",{type:"button",onClick:this.props.functionOnCLick,className:"button-edit-profile",children:this.props.nameButton})}}]),n}(f.Component),_=n(7471),E=n(1664),U=n(5675),C=n(614);function w(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var s=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var S=function(t){(0,i.Z)(n,t);var e=w(n);function n(){return(0,s.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){return(0,r.jsxs)("form",{className:"form profile__info-form",children:[(0,r.jsx)(C.Z,{label:"Name",type:"text",id:"name-user",readonly:this.props.flag,value:this.props.userName,functionOnChange:this.props.handleChange}),(0,r.jsx)(C.Z,{label:"E-mail",type:"email",id:"email",readonly:this.props.flag,value:this.props.userEmail,functionOnChange:this.props.handleChange})]})}}]),n}(f.Component);function x(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var s=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var R=function(t){(0,i.Z)(n,t);var e=x(n);function n(){return(0,s.Z)(this,n),e.apply(this,arguments)}return(0,a.Z)(n,[{key:"render",value:function(){return(0,r.jsx)("div",{className:"loader",children:(0,r.jsx)("h5",{className:"loader__text",children:"Loading..."})})}}]),n}(f.Component);function N(t){var e=function(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=(0,c.Z)(t);if(e){var s=(0,c.Z)(this).constructor;n=Reflect.construct(r,arguments,s)}else n=r.apply(this,arguments);return(0,u.Z)(this,n)}}var j=function(t){(0,i.Z)(n,t);var e=N(n);function n(t){var r;return(0,s.Z)(this,n),r=e.call(this,t),(0,l.Z)((0,o.Z)(r),"getAvatar",(function(t){var e=(0,o.Z)(r),n=r.containerImage.current;d.Z.storage().ref().child("avatars/".concat(t)).getDownloadURL().then((function(t){t&&(n.innerHTML="<img src=".concat(t,' alt="photo"/>'),e.props.setUserAvatarFunction(t))})).then((function(){e.setState({isLoading:!1})}))})),(0,l.Z)((0,o.Z)(r),"changeUserInfo",(function(){r.setState({flag:!r.state.flag})})),(0,l.Z)((0,o.Z)(r),"saveUserInfo",(function(){var t=d.Z.database();r.setState({flag:!r.state.flag}),t.ref("/users/user"+r.state.idUser).update({name:r.props.userName,email:r.props.userEmail}),d.Z.auth().currentUser.updateEmail(r.props.userEmail)})),(0,l.Z)((0,o.Z)(r),"logout",(function(){r.props.setUserNameFunction(""),r.props.setUserEmailFunction(""),r.props.setUserSumFunction(0),d.Z.auth().signOut(),r.props.router.push("/")})),(0,l.Z)((0,o.Z)(r),"openModalWindowChangePassword",(function(){document.querySelector(".modal-window.modal-window__change-password").classList.add("open")})),(0,l.Z)((0,o.Z)(r),"openModalWindowChangeAvatar",(function(){document.querySelector(".modal-window.modal-window__change-avatar").classList.add("open")})),(0,l.Z)((0,o.Z)(r),"handleChange",(function(t){switch(t.target.name){case"name-user":r.props.setUserNameFunction(t.target.value);break;case"email":r.props.setUserEmailFunction(t.target.value)}})),(0,l.Z)((0,o.Z)(r),"deleteProfile",(function(){var t=(0,o.Z)(r);d.Z.auth().currentUser.delete().then((function(){d.Z.database().ref("users/user"+t.props.userId).remove().then((function(){this.props.history.push("/check-in")})).catch((function(t){return console.log(t.message)}))}))})),r.state={flag:!0,idUser:"",loc:t.router.query.loc,isLoading:!0},r.containerImage=f.createRef(),r}return(0,a.Z)(n,[{key:"componentDidMount",value:function(){var t=d.Z.database(),e=this;d.Z.auth().onAuthStateChanged((function(n){if(n){var r=n.email;t.ref("/users").on("value",(function(t){var n=t.val();for(var s in n)r===n[s].email&&(e.setState({idUser:n[s].id}),e.props.setUserIdFunction(n[s].id),e.props.setUserNameFunction(n[s].name),e.props.setUserEmailFunction(n[s].email),e.props.setUserSumFunction(n[s].money),e.props.setUserIncomeCardsFunction(n[s].cardsIncome),e.props.setUserExpensesCardsFunction(n[s].cardsExpenses),e.getAvatar(n[s].id))}))}}))}},{key:"render",value:function(){return(0,r.jsxs)(_.Z,{children:[this.state.isLoading&&(0,r.jsx)(R,{}),this.props.userId&&(0,r.jsxs)("div",{className:"content__logged-in".concat(this.state.isLoading?" disabled":""),children:[(0,r.jsx)(v.Z,{page:"profile-password",nameClass:"modal-window modal-window__change-password"}),(0,r.jsx)(v.Z,{idUser:this.props.userId,page:"profile-avatar",nameClass:"modal-window modal-window__change-avatar",history:this.props.history}),(0,r.jsx)("h1",{className:"title",children:"Profile"}),(0,r.jsxs)("div",{className:"profile",children:[(0,r.jsx)("div",{className:"profile__image wrapper-img",ref:this.containerImage,children:(0,r.jsx)(U.default,{src:p.Z,alt:"photo"})}),(0,r.jsx)(S,{handleChange:this.handleChange,flag:this.state.flag,userName:this.props.userName,userEmail:this.props.userEmail})]}),(0,r.jsxs)("div",{className:"profile__wrapper-buttons",children:[this.state.flag&&(0,r.jsx)(Z,{functionOnCLick:this.changeUserInfo,nameButton:"Change information about yourself"}),!this.state.flag&&(0,r.jsx)(Z,{functionOnCLick:this.saveUserInfo,nameButton:"Save"}),(0,r.jsx)(Z,{functionOnCLick:this.openModalWindowChangePassword,nameButton:"Change password"}),(0,r.jsx)(Z,{functionOnCLick:this.openModalWindowChangeAvatar,nameButton:"Change avatar"}),(0,r.jsx)(Z,{functionOnCLick:this.logout,nameButton:"Log out"}),(0,r.jsx)(Z,{functionOnCLick:this.deleteProfile,nameButton:"Delete profile"})]})]}),!this.props.userId&&(0,r.jsxs)("div",{className:"content__unlogged ".concat(this.state.isLoading?" disabled":""),children:[(0,r.jsx)("h1",{className:"title",children:"You are not logged in!"}),(0,r.jsx)(E.default,{href:"/login",children:(0,r.jsx)("a",{className:"button-open-login-page",children:"Sign in"})})]})]})}}]),n}(f.Component);var I=(0,h.$j)((function(t){return{userId:t.userInfo.idUser,userName:t.userInfo.userName,userEmail:t.userInfo.userEmail,userSum:t.userInfo.userSum,userAvatar:t.userInfo.userAvatar}}),(function(t){return{setUserIdFunction:function(e){t({type:"SET_USER_ID",payload:e})},setUserAvatarFunction:function(e){t(function(t){return{type:"SET_USER_AVATAR",payload:t}}(e))},setUserNameFunction:function(e){t(function(t){return{type:"SET_USER_NAME",payload:t}}(e))},setUserEmailFunction:function(e){t({type:"SET_USER_EMAIL",payload:e})},setUserSumFunction:function(e){t((0,g.A)(e))},setUserIncomeCardsFunction:function(e){t(function(t){return{type:"SET_USER_INCOME_CARDS",payload:t}}(e))},setUserExpensesCardsFunction:function(e){t(function(t){return{type:"SET_USER_EXPENSES_CARDS",payload:t}}(e))}}}))((0,m.withRouter)(j))},883:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return n(5119)}])}},function(t){t.O(0,[882,676,608,774,888,179],(function(){return e=883,t(t.s=e);var e}));var e=t.O();_N_E=e}]);